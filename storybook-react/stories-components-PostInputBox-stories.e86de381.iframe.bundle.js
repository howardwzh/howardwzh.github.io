"use strict";(self.webpackChunkstorybook_react=self.webpackChunkstorybook_react||[]).push([[329],{"./src/stories/components/PostInputBox.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{FullFeaturedExample:()=>FullFeaturedExample,__namedExportsOrder:()=>__namedExportsOrder,default:()=>PostInputBox_stories});var react=__webpack_require__("./node_modules/react/index.js"),lib=__webpack_require__("./node_modules/react-quill/lib/index.js"),lib_default=__webpack_require__.n(lib),emoji_regex=(__webpack_require__("./node_modules/react-quill/dist/quill.snow.css"),__webpack_require__("./node_modules/emoji-regex/index.js")),emoji_regex_default=__webpack_require__.n(emoji_regex),lodash=__webpack_require__("./node_modules/lodash/lodash.js"),twemoji_esm=__webpack_require__("./node_modules/twemoji/dist/twemoji.esm.js");const getEmojiUrl=emoji=>`https://cdn.jsdelivr.net/gh/twitter/twemoji@latest/assets/svg/${null===twemoji_esm.A||void 0===twemoji_esm.A?void 0:twemoji_esm.A.convert.toCodePoint(emoji)}.svg`,registerCustomFormat=()=>{const Inline=lib.Quill.import("blots/inline"),Embed=lib.Quill.import("blots/embed");class CustomExceed extends Inline{}CustomExceed.blotName="exceed",CustomExceed.tagName="exceed",lib.Quill.register(CustomExceed);class EmojiBlot extends Embed{static create(data){const isObject="object"==typeof data,emoji=isObject?data.emoji:data,src=isObject?data.src:getEmojiUrl(emoji),node=super.create();return node.innerHTML=`<img src="${src}" alt="${emoji}"/>`,node}static value(node){const emojiMatch=node.innerHTML.match(emoji_regex_default()()),srcMatch=node.innerHTML.match(/<img src="([^"]+)"/);return{emoji:emojiMatch?emojiMatch[0]:"",src:srcMatch?srcMatch[1]:""}}}EmojiBlot.blotName="emoji",EmojiBlot.tagName="emoji",lib.Quill.register(EmojiBlot)},quillHelper=(()=>{let quill=null;function createQuillHelper(){registerCustomFormat();const div=document.createElement("div");div.setAttribute("id","quillHelperWrapper"),div.style.display="none",div.innerHTML='<div id="quillHelper"/>',document.body.appendChild(div);return new lib.Quill("#quillHelper",{theme:"snow"})}return{htmlToDelta:function htmlToDelta(html){return quill||(quill=createQuillHelper()),quill.clipboard.convert(html)},deltaToHtml:function deltaToHtml(delta){return quill||(quill=createQuillHelper()),quill.setContents(delta),quill.root.innerHTML}}})(),htmlToDelta=(html,type)=>{const delta=quillHelper.htmlToDelta((text=>{let result=/<[^>]+>/.test(text)?text.replace(/([^>]*)</g,(all=>all.replace(/\n/g,"•ั๑♧").replace(/\s/g,"♕۞❀"))).replace(/>([^<]*)/g,(all=>all.replace(/\n/g,"•ั๑♧").replace(/\s/g,"♕۞❀"))):text.replace(/\n/g,"•ั๑♧").replace(/\s/g,"♕۞❀");return result=result.replace(new RegExp("(<[^/>]+>)•ั๑♧(</[^>]+>)","g"),"$1\n$2"),result})(html));return{ops:[...delta?(0,lodash.compact)(delta.ops.map(((item,index)=>{var _item$attributes,insert;"final"===type?(null==item||null===(_item$attributes=item.attributes)||void 0===_item$attributes?void 0:_item$attributes.link)&&(item.attributes.link=item.attributes.link.replace(/_isMyself|_isMention/,"")):/.+\n$/.test(null==item?void 0:item.insert)&&!delta.ops[index+1]&&(item.insert=null==item?void 0:item.insert.replace(/\n$/,""));return{...item,insert:(insert=item.insert,"string"==typeof insert?insert.replace(new RegExp("•ั๑♧(\n)","g"),"$1").replace(new RegExp("(♕۞❀)","g")," ").replace(new RegExp("•ั๑♧","g"),"\n"):insert)}}))):[{insert:""}]]}},changeTextToHtml=_ref=>{let{text=""}=_ref;if("string"!=typeof text)return null;const needChange=new RegExp(`${emoji_regex_default()().source}`).test(text);let html=text;return html=html.replace(/\uFEFF/g,"").replace(new RegExp(`(${emoji_regex_default()().source})`,"g"),(emoji=>`<emoji><span contenteditable="false"><img src="${getEmojiUrl(emoji)}" alt="${emoji}"></span></emoji>`)),{isChanged:needChange,html}},setLinesFormat=_ref2=>{var _range$index;let{quill}=_ref2;const range=quill.getSelection(),rangeIndex=null!==(_range$index=null==range?void 0:range.index)&&void 0!==_range$index?_range$index:0,index=0===rangeIndex?0:rangeIndex-1,length=0===index?2:3,[,offset]=quill.getLine(index),startIndex=index-offset,lines=quill.getLines(index,length),oldLinesHtml=lines.map(((l,i)=>!lines[i-1]||/^<br\/?>$/.test(lines[i-1].domNode.innerHTML)?l.domNode.innerHTML:`\n${l.domNode.innerHTML}`)).join("").replace(/\uFEFF/g,""),linesText=getRichContent(oldLinesHtml,"text"),oldTextWithoutOldEmojis=getRichContent(oldLinesHtml,"text"," "),oldLength=oldTextWithoutOldEmojis.length;replaceDelta({quill,text:linesText,startIndex,oldLinesHtml,oldLength}),range&&quill.setSelection(startIndex+getTextLength(oldTextWithoutOldEmojis.slice(0,offset+1)),range.length)},replaceDelta=_ref3=>{let{quill,text,startIndex,oldLinesHtml,oldLength}=_ref3;const{html:content}=changeTextToHtml({text});if(b=oldLinesHtml,content.replace(/\uFEFF/g,"")===b.replace(/\uFEFF/g,"").replace(/<br\/?>/g,"\n"))return;var b;const{ops}=htmlToDelta(content);quill.deleteText(startIndex,oldLength),quill.updateContents({ops:[...0===startIndex?[]:[{retain:startIndex}],...ops]})},getTextLength=text=>{var _text$match$length,_text$match;return text.replace(emoji_regex_default()(),"").length+(null!==(_text$match$length=null===(_text$match=text.match(emoji_regex_default()()))||void 0===_text$match?void 0:_text$match.length)&&void 0!==_text$match$length?_text$match$length:0)},getRichContent=(html,type,imgPlaceholder)=>{let result=html.replace(/\uFEFF/g,"").replace(/<img[^>]*alt="([^"]*)"[^>]*>/g,((all,$1)=>imgPlaceholder||$1)).replace(/<\/?(span|sup|sub|emoji)[^>]*>/g,"").replace(/(<p><br\/?><\/p>)/g,"\n").replace(/<p[^>]*style=[^>]*>.*<\/p>/g,"").replace(/(<\/em><em>)/g,"").replace(/(<\/strong><strong>)/g,"").replace(/(<\/em><em>)/g,"").replace(/(<\/strong><strong>)/g,"").replace(/(<br\/?>)/g,"\n");return result="final"===type?result.replace(/<p[^>]*style=[^>]*>.*<\/p>/g,""):result.replace(/<(p)[^>]*>([\s\S]*?)<\/\1>/gi,"$2\n"),"text"===type?result=result.replace(/<\/?(a)[^>]*>/g,"").replace(/<li[^>]*>\n<\/li>/g,"\n").replace(/<\/h2>|<\/ul>|<\/ol>|<\/li><li[^>]*>/g,"\n").replace(/<\/?(strong|em|h2|ul|ol|li|exceed|highlight|u|s)[^>]*>/g,""):"withoutLink"===type&&(result=result.replace(/<\/?(a)[^>]*>/g,"")),decodeHtmlCode(result)},decodeHtmlCode=html=>{const textarea=document.createElement("textarea");return textarea.innerHTML=html,textarea.value};var jsx_runtime=__webpack_require__("./node_modules/react/jsx-runtime.js");const formats=["header","bold","underline","list","link","emoji"],customModule={toolbar:[[{header:[1,2,!1]}],["bold","underline"],["list","bullet"],["emoji"]]},PostInputBoxWrapper=()=>{const[content,setContent]=(0,react.useState)("");return(0,react.useEffect)((()=>{registerCustomFormat()}),[]),(0,jsx_runtime.jsx)(PostInputBox,{content,onChange:delta=>{}})},PostInputBox=_ref=>{let{content,onChange,maxLength}=_ref;const[quillRef,setQuillRef]=(0,react.useState)(null),timeRef=(0,react.useRef)({handleChange:null}),syncRef=(0,react.useRef)({stopChange:!1});(0,react.useEffect)((()=>{if(quillRef){const quill=quillRef.editor;return null==quill||quill.root.addEventListener("compositionstart",handleComposStart),null==quill||quill.root.addEventListener("compositionend",handleComposEnd),()=>{null==quill||quill.root.removeEventListener("compositionstart",handleComposStart),null==quill||quill.root.removeEventListener("compositionend",handleComposEnd)}}}),[quillRef]);const handleChange=(0,react.useCallback)((value=>{quillRef&&(timeRef.current.handleChange&&clearTimeout(timeRef.current.handleChange),timeRef.current.handleChange=setTimeout((()=>{var _quillRef$editor,quill;syncRef.current.stopChange||(quill=quillRef.editor,setLinesFormat({quill}),onChange&&onChange(null===(_quillRef$editor=quillRef.editor)||void 0===_quillRef$editor?void 0:_quillRef$editor.getContents()))}),100))}),[quillRef,maxLength]),handleComposStart=()=>{syncRef.current.stopChange=!0},handleComposEnd=()=>{syncRef.current.stopChange=!1};return(0,jsx_runtime.jsx)("div",{className:"post-input-box",children:(0,jsx_runtime.jsx)(lib_default(),{ref:ref=>setQuillRef(ref),value:content,onChange:handleChange,modules:customModule,formats})})},components_PostInputBox=PostInputBoxWrapper;PostInputBoxWrapper.__docgenInfo={description:"",methods:[],displayName:"PostInputBoxWrapper"};const PostInputBox_stories={title:"Components/PostInputBox",component:components_PostInputBox},FullFeaturedExample={args:{},decorators:[Story=>(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsx)("p",{children:"This example showcases all features:"}),(0,jsx_runtime.jsxs)("ul",{children:[(0,jsx_runtime.jsx)("li",{children:"Rich text formatting (header, bold, underline, list)"}),(0,jsx_runtime.jsx)("li",{children:"Auto-detection of links, mentions, and hashtags"}),(0,jsx_runtime.jsx)("li",{children:"Emoji support with Twemoji style"}),(0,jsx_runtime.jsx)("li",{children:"Autocomplete for mentions and hashtags"})]}),(0,jsx_runtime.jsx)("p",{children:"Try the following:"}),(0,jsx_runtime.jsxs)("ol",{children:[(0,jsx_runtime.jsx)("li",{children:"Type a link: https://example.com"}),(0,jsx_runtime.jsx)("li",{children:"Use @username or #topic"}),(0,jsx_runtime.jsx)("li",{children:"Insert emojis: 😊🚀"}),(0,jsx_runtime.jsx)("li",{children:"Start typing @ or # for autocomplete suggestions"})]}),(0,jsx_runtime.jsx)(Story,{})]})]},__namedExportsOrder=["FullFeaturedExample"];FullFeaturedExample.parameters={...FullFeaturedExample.parameters,docs:{...FullFeaturedExample.parameters?.docs,source:{originalSource:"{\n  args: {},\n  decorators: [Story => <div>\n        <p>This example showcases all features:</p>\n        <ul>\n          <li>Rich text formatting (header, bold, underline, list)</li>\n          <li>Auto-detection of links, mentions, and hashtags</li>\n          <li>Emoji support with Twemoji style</li>\n          <li>Autocomplete for mentions and hashtags</li>\n        </ul>\n        <p>Try the following:</p>\n        <ol>\n          <li>Type a link: https://example.com</li>\n          <li>Use @username or #topic</li>\n          <li>Insert emojis: 😊🚀</li>\n          <li>Start typing @ or # for autocomplete suggestions</li>\n        </ol>\n        <Story />\n      </div>]\n}",...FullFeaturedExample.parameters?.docs?.source}}}}}]);